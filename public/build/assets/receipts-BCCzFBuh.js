import{n as a,R as s}from"./_plugin-vue2_normalizer-Dge3eF8E.js";import"./vendor-BbM-DNPz.js";const o={data(){return{fields:[{key:"id",label:"#",sortable:!0},{key:"created_at",label:"Время",sortable:!0},{key:"connection",label:"Соединение",sortable:!0},{key:"operation",label:"Тип",sortable:!0},{key:"payload.total",label:"Сумма",sortable:!0},{key:"state",label:"Статус",sortable:!0}],aliases:{"payload.total":"total"},receipts:{},page:1}},mounted(){this.populateQuery(),this.enumConnections(),this.getReceipts()},methods:{populateQuery(){sessionStorage["fiscal-registrar.page"]&&(this.page=+sessionStorage["fiscal-registrar.page"])},async getReceipts(l=null){l&&(this.page=l);const e=new s;Object.entries(this.query.filter).filter(([r,i])=>!!i).forEach(([r,i])=>e.where(r,i));let t=this.aliases[this.query.sort.by]??this.query.sort.by;this.query.sort.desc&&(t="-"+t),e.orderBy(t),this.page&&e.page(this.page),this.receipts=await e.get()}},computed:{selectConnections(){return[{value:null,text:"любое"},...this.buildOptions(this.connections,([l,e])=>({value:l,text:e.display_name}))]},selectOperations(){return[{value:null,text:"все"},...this.buildOptions(this.dictionary.operations)]},selectStates(){return[{value:null,text:"любой"},...this.buildOptions(this.dictionary.states)]}},watch:{query:{handler:function(l){this.getReceipts(1)},deep:!0},page:function(l){sessionStorage["fiscal-registrar.page"]=l}}};var n=function(){var e=this,t=e._self._c;return t("div",[t("h2",{staticClass:"text-center"},[e._v("Кассовые чеки")]),e.query.hideFilter?e._e():t("b-form-group",[t("b-container",{attrs:{fluid:""}},[t("b-form-row",{staticClass:"my-1"},[t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Порядковый номер","label-for":"receiptId"}},[t("b-form-input",{attrs:{id:"receiptId",type:"number",size:"sm",debounce:"500"},model:{value:e.query.filter.id,callback:function(r){e.$set(e.query.filter,"id",e._n(r))},expression:"query.filter.id"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Уникальный идентификатор","label-for":"receiptExternalId"}},[t("b-form-input",{attrs:{id:"receiptExternalId",type:"text",size:"sm",debounce:"500"},model:{value:e.query.filter.external_id,callback:function(r){e.$set(e.query.filter,"external_id",r)},expression:"query.filter.external_id"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Идентификатор поставщика","label-for":"receiptInternalId"}},[t("b-form-input",{attrs:{id:"receiptInternalId",type:"text",size:"sm",debounce:"500"},model:{value:e.query.filter.internal_id,callback:function(r){e.$set(e.query.filter,"internal_id",r)},expression:"query.filter.internal_id"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Время создания от","label-for":"receiptCreatedFrom"}},[t("b-form-input",{attrs:{id:"receiptCreatedFrom",type:"datetime-local",size:"sm"},model:{value:e.query.filter.created_from,callback:function(r){e.$set(e.query.filter,"created_from",r)},expression:"query.filter.created_from"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Время создания до","label-for":"receiptCreatedTo"}},[t("b-form-input",{attrs:{id:"receiptCreatedTo",type:"datetime-local",size:"sm"},model:{value:e.query.filter.created_to,callback:function(r){e.$set(e.query.filter,"created_to",r)},expression:"query.filter.created_to"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Соединение","label-for":"receiptConnection"}},[t("b-form-select",{attrs:{id:"receiptConnection",size:"sm",options:e.selectConnections},model:{value:e.query.filter.connection,callback:function(r){e.$set(e.query.filter,"connection",r)},expression:"query.filter.connection"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Операция","label-for":"receiptOperation"}},[t("b-form-select",{attrs:{id:"receiptOperation",size:"sm",options:e.selectOperations},model:{value:e.query.filter.operation,callback:function(r){e.$set(e.query.filter,"operation",r)},expression:"query.filter.operation"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Сумма от","label-for":"receiptMinTotal"}},[t("b-form-input",{attrs:{id:"receiptMinTotal",type:"number",min:"0",max:e.query.filter.max_total||4294967295e-2,step:".01",size:"sm",debounce:"500"},model:{value:e.query.filter.min_total,callback:function(r){e.$set(e.query.filter,"min_total",e._n(r))},expression:"query.filter.min_total"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Сумма до","label-for":"receiptMaxTotal"}},[t("b-form-input",{attrs:{id:"receiptMaxTotal",type:"number",min:e.query.filter.min_total||0,max:"42949672.95",step:".01",size:"sm",debounce:"500"},model:{value:e.query.filter.max_total,callback:function(r){e.$set(e.query.filter,"max_total",e._n(r))},expression:"query.filter.max_total"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Статус","label-for":"receiptState"}},[t("b-form-select",{attrs:{id:"receiptState",size:"sm",options:e.selectStates},model:{value:e.query.filter.state,callback:function(r){e.$set(e.query.filter,"state",r)},expression:"query.filter.state"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"E-mail клиента","label-for":"receiptClientEmail"}},[t("b-form-input",{attrs:{id:"receiptClientEmail",type:"email",size:"sm",placeholder:"user@domain.com",debounce:"500"},model:{value:e.query.filter.email,callback:function(r){e.$set(e.query.filter,"email",r)},expression:"query.filter.email"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"Телефон клиента","label-for":"receiptClientPhone"}},[t("b-form-input",{attrs:{id:"receiptClientPhone",type:"tel",size:"sm",placeholder:"+79001234567",debounce:"500"},model:{value:e.query.filter.phone,callback:function(r){e.$set(e.query.filter,"phone",r)},expression:"query.filter.phone"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"ФН","label-for":"receiptFnNumber"}},[t("b-form-input",{attrs:{id:"receiptFnNumber",type:"number",size:"sm",debounce:"500"},model:{value:e.query.filter.fn,callback:function(r){e.$set(e.query.filter,"fn",e._n(r))},expression:"query.filter.fn"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"ФД №","label-for":"receiptFiscalDocumentNumber"}},[t("b-form-input",{attrs:{id:"receiptFiscalDocumentNumber",type:"number",size:"sm",debounce:"500"},model:{value:e.query.filter.i,callback:function(r){e.$set(e.query.filter,"i",e._n(r))},expression:"query.filter.i"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{attrs:{label:"ФПД","label-for":"receiptFiscalDocumentAttribute"}},[t("b-form-input",{attrs:{id:"receiptFiscalDocumentAttribute",type:"number",size:"sm",debounce:"500"},model:{value:e.query.filter.fd,callback:function(r){e.$set(e.query.filter,"fd",e._n(r))},expression:"query.filter.fd"}})],1)],1),t("b-col",{attrs:{"align-self":"end",lg:"2",md:"3",sm:"4"}},[t("b-form-group",{staticClass:"text-center"},[t("b-button",{attrs:{variant:"danger",size:"sm"},on:{click:e.resetFilter}},[e._v("Очистить фильтр")])],1)],1)],1)],1)],1),t("b-table",{attrs:{small:"",striped:"",hover:"",items:e.receipts.data,fields:e.fields,"no-local-sorting":"","sort-by":e.query.sort.by,"sort-desc":e.query.sort.desc},on:{"update:sortBy":function(r){return e.$set(e.query.sort,"by",r)},"update:sort-by":function(r){return e.$set(e.query.sort,"by",r)},"update:sortDesc":function(r){return e.$set(e.query.sort,"desc",r)},"update:sort-desc":function(r){return e.$set(e.query.sort,"desc",r)}},scopedSlots:e._u([{key:"cell(id)",fn:function(r){return[t("b-link",{attrs:{to:{name:"receipt",params:{id:r.value}}}},[e._v(e._s(r.value))])]}},{key:"cell(created_at)",fn:function(r){return[e._v(" "+e._s(e.formatTime(r.value))+" ")]}},{key:"cell(connection)",fn:function(r){return[e._v(" "+e._s(r.value?e.connections[r.value].display_name:"-")+" ")]}},{key:"cell(operation)",fn:function(r){return[e._v(" "+e._s(r.value?e.dictionary.operations[r.value]:"-")+" ")]}},{key:"cell(payload.total)",fn:function(r){return[t("div",{staticClass:"text-right"},[e._v(e._s(r.value))])]}},{key:"cell(state)",fn:function(r){return[e._v(" "+e._s(e.dictionary.states[r.value])+" ")]}}])}),t("pagination",{attrs:{data:e.receipts,limit:2,"show-disabled":!0,align:"center"},on:{"pagination-change-page":e.getReceipts}}),e.query.hideCreateButton?e._e():t("b-button",{attrs:{to:{name:"new-receipt"},variant:"primary",size:"sm"}},[e._v("Создать")])],1)},c=[],u=a(o,n,c,!1,null,null);const p=u.exports;export{p as default};
//# sourceMappingURL=receipts-BCCzFBuh.js.map
