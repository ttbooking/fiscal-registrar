{"version":3,"file":"receipts-l0Rhz7VZ.js","sources":["../../../resources/js/screens/receipts.vue"],"sourcesContent":["<script>\nimport Receipt from \"../models/Receipt\";\n\nexport default {\n    data() {\n        return {\n            fields: [\n                { key: \"id\", label: \"#\", sortable: true },\n                { key: \"created_at\", label: \"Время\", sortable: true },\n                { key: \"connection\", label: \"Соединение\", sortable: true },\n                { key: \"operation\", label: \"Тип\", sortable: true },\n                { key: \"payload.total\", label: \"Сумма\", sortable: true },\n                { key: \"state\", label: \"Статус\", sortable: true },\n            ],\n            aliases: {\n                \"payload.total\": \"total\",\n            },\n            receipts: {},\n            page: 1,\n        };\n    },\n\n    mounted() {\n        this.populateQuery();\n        this.enumConnections();\n        this.getReceipts();\n    },\n\n    methods: {\n        populateQuery() {\n            sessionStorage[\"fiscal-registrar.page\"] && (this.page = +sessionStorage[\"fiscal-registrar.page\"]);\n        },\n\n        async getReceipts(page = null) {\n            page && (this.page = page);\n            const receipt = new Receipt();\n            Object.entries(this.query.filter)\n                .filter(([key, val]) => !!val)\n                .forEach(([key, val]) => receipt.where(key, val));\n            let column = this.aliases[this.query.sort.by] ?? this.query.sort.by;\n            this.query.sort.desc && (column = \"-\" + column);\n            receipt.orderBy(column);\n            this.page && receipt.page(this.page);\n            this.receipts = await receipt.get();\n        },\n    },\n\n    computed: {\n        selectConnections() {\n            return [\n                { value: null, text: \"любое\" },\n                ...this.buildOptions(this.connections, ([name, data]) => ({ value: name, text: data.display_name })),\n            ];\n        },\n\n        selectOperations() {\n            return [{ value: null, text: \"все\" }, ...this.buildOptions(this.dictionary.operations)];\n        },\n\n        selectStates() {\n            return [{ value: null, text: \"любой\" }, ...this.buildOptions(this.dictionary.states)];\n        },\n    },\n\n    watch: {\n        query: {\n            handler: function (query) {\n                this.getReceipts(1);\n            },\n            deep: true,\n        },\n        page: function (page) {\n            sessionStorage[\"fiscal-registrar.page\"] = page;\n        },\n    },\n};\n</script>\n\n<template>\n    <div>\n        <h2 class=\"text-center\">Кассовые чеки</h2>\n\n        <b-form-group v-if=\"!query.hideFilter\">\n            <b-container fluid>\n                <b-form-row class=\"my-1\">\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Порядковый номер\" label-for=\"receiptId\">\n                            <b-form-input\n                                id=\"receiptId\"\n                                type=\"number\"\n                                size=\"sm\"\n                                v-model.number=\"query.filter.id\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Уникальный идентификатор\" label-for=\"receiptExternalId\">\n                            <b-form-input\n                                id=\"receiptExternalId\"\n                                type=\"text\"\n                                size=\"sm\"\n                                v-model=\"query.filter.external_id\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Идентификатор поставщика\" label-for=\"receiptInternalId\">\n                            <b-form-input\n                                id=\"receiptInternalId\"\n                                type=\"text\"\n                                size=\"sm\"\n                                v-model=\"query.filter.internal_id\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Время создания от\" label-for=\"receiptCreatedFrom\">\n                            <b-form-input\n                                id=\"receiptCreatedFrom\"\n                                type=\"datetime-local\"\n                                size=\"sm\"\n                                v-model=\"query.filter.created_from\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Время создания до\" label-for=\"receiptCreatedTo\">\n                            <b-form-input\n                                id=\"receiptCreatedTo\"\n                                type=\"datetime-local\"\n                                size=\"sm\"\n                                v-model=\"query.filter.created_to\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Соединение\" label-for=\"receiptConnection\">\n                            <b-form-select\n                                id=\"receiptConnection\"\n                                size=\"sm\"\n                                v-model=\"query.filter.connection\"\n                                :options=\"selectConnections\"\n                            ></b-form-select>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Операция\" label-for=\"receiptOperation\">\n                            <b-form-select\n                                id=\"receiptOperation\"\n                                size=\"sm\"\n                                v-model=\"query.filter.operation\"\n                                :options=\"selectOperations\"\n                            ></b-form-select>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Сумма от\" label-for=\"receiptMinTotal\">\n                            <b-form-input\n                                id=\"receiptMinTotal\"\n                                type=\"number\"\n                                min=\"0\"\n                                :max=\"query.filter.max_total || 42949672.95\"\n                                step=\".01\"\n                                size=\"sm\"\n                                v-model.number=\"query.filter.min_total\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Сумма до\" label-for=\"receiptMaxTotal\">\n                            <b-form-input\n                                id=\"receiptMaxTotal\"\n                                type=\"number\"\n                                :min=\"query.filter.min_total || 0\"\n                                max=\"42949672.95\"\n                                step=\".01\"\n                                size=\"sm\"\n                                v-model.number=\"query.filter.max_total\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Статус\" label-for=\"receiptState\">\n                            <b-form-select\n                                id=\"receiptState\"\n                                size=\"sm\"\n                                v-model=\"query.filter.state\"\n                                :options=\"selectStates\"\n                            ></b-form-select>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"E-mail клиента\" label-for=\"receiptClientEmail\">\n                            <b-form-input\n                                id=\"receiptClientEmail\"\n                                type=\"email\"\n                                size=\"sm\"\n                                placeholder=\"user@domain.com\"\n                                v-model=\"query.filter.email\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"Телефон клиента\" label-for=\"receiptClientPhone\">\n                            <b-form-input\n                                id=\"receiptClientPhone\"\n                                type=\"tel\"\n                                size=\"sm\"\n                                placeholder=\"+79001234567\"\n                                v-model=\"query.filter.phone\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"ФН\" label-for=\"receiptFnNumber\">\n                            <b-form-input\n                                id=\"receiptFnNumber\"\n                                type=\"number\"\n                                size=\"sm\"\n                                v-model.number=\"query.filter.fn\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"ФД №\" label-for=\"receiptFiscalDocumentNumber\">\n                            <b-form-input\n                                id=\"receiptFiscalDocumentNumber\"\n                                type=\"number\"\n                                size=\"sm\"\n                                v-model.number=\"query.filter.i\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group label=\"ФПД\" label-for=\"receiptFiscalDocumentAttribute\">\n                            <b-form-input\n                                id=\"receiptFiscalDocumentAttribute\"\n                                type=\"number\"\n                                size=\"sm\"\n                                v-model.number=\"query.filter.fd\"\n                                debounce=\"500\"\n                            ></b-form-input>\n                        </b-form-group>\n                    </b-col>\n                    <b-col align-self=\"end\" lg=\"2\" md=\"3\" sm=\"4\">\n                        <b-form-group class=\"text-center\">\n                            <b-button variant=\"danger\" size=\"sm\" @click=\"resetFilter\">Очистить фильтр</b-button>\n                        </b-form-group>\n                    </b-col>\n                </b-form-row>\n            </b-container>\n        </b-form-group>\n\n        <b-table\n            small\n            striped\n            hover\n            :items=\"receipts.data\"\n            :fields=\"fields\"\n            no-local-sorting\n            :sort-by.sync=\"query.sort.by\"\n            :sort-desc.sync=\"query.sort.desc\"\n        >\n            <template #cell(id)=\"data\">\n                <b-link :to=\"{ name: 'receipt', params: { id: data.value } }\">{{ data.value }}</b-link>\n            </template>\n            <template #cell(created_at)=\"data\">\n                {{ formatTime(data.value) }}\n            </template>\n            <template #cell(connection)=\"data\">\n                {{ data.value ? connections[data.value].display_name : \"-\" }}\n            </template>\n            <template #cell(operation)=\"data\">\n                {{ data.value ? dictionary.operations[data.value] : \"-\" }}\n            </template>\n            <template #cell(payload.total)=\"data\">\n                <div class=\"text-right\">{{ data.value }}</div>\n            </template>\n            <template #cell(state)=\"data\">\n                {{ dictionary.states[data.value] }}\n            </template>\n        </b-table>\n\n        <pagination\n            :data=\"receipts\"\n            :limit=\"2\"\n            :show-disabled=\"true\"\n            align=\"center\"\n            @pagination-change-page=\"getReceipts\"\n        ></pagination>\n\n        <b-button v-if=\"!query.hideCreateButton\" :to=\"{ name: 'new-receipt' }\" variant=\"primary\" size=\"sm\"\n            >Создать</b-button\n        >\n    </div>\n</template>\n"],"names":["_sfc_main","page","receipt","Receipt","key","val","column","name","data","query"],"mappings":"8FAGA,MAAAA,EAAA,CACA,MAAA,CACA,MAAA,CACA,OAAA,CACA,CAAA,IAAA,KAAA,MAAA,IAAA,SAAA,EAAA,EACA,CAAA,IAAA,aAAA,MAAA,QAAA,SAAA,EAAA,EACA,CAAA,IAAA,aAAA,MAAA,aAAA,SAAA,EAAA,EACA,CAAA,IAAA,YAAA,MAAA,MAAA,SAAA,EAAA,EACA,CAAA,IAAA,gBAAA,MAAA,QAAA,SAAA,EAAA,EACA,CAAA,IAAA,QAAA,MAAA,SAAA,SAAA,EAAA,CACA,EACA,QAAA,CACA,gBAAA,OACA,EACA,SAAA,CAAA,EACA,KAAA,CACA,CACA,EAEA,SAAA,CACA,KAAA,cAAA,EACA,KAAA,gBAAA,EACA,KAAA,YAAA,CACA,EAEA,QAAA,CACA,eAAA,CACA,eAAA,uBAAA,IAAA,KAAA,KAAA,CAAA,eAAA,uBAAA,EACA,EAEA,MAAA,YAAAC,EAAA,KAAA,CACAA,IAAA,KAAA,KAAAA,GACA,MAAAC,EAAA,IAAAC,EACA,OAAA,QAAA,KAAA,MAAA,MAAA,EACA,OAAA,CAAA,CAAAC,EAAAC,CAAA,IAAA,CAAA,CAAAA,CAAA,EACA,QAAA,CAAA,CAAAD,EAAAC,CAAA,IAAAH,EAAA,MAAAE,EAAAC,CAAA,CAAA,EACA,IAAAC,EAAA,KAAA,QAAA,KAAA,MAAA,KAAA,EAAA,GAAA,KAAA,MAAA,KAAA,GACA,KAAA,MAAA,KAAA,OAAAA,EAAA,IAAAA,GACAJ,EAAA,QAAAI,CAAA,EACA,KAAA,MAAAJ,EAAA,KAAA,KAAA,IAAA,EACA,KAAA,SAAA,MAAAA,EAAA,IAAA,CACA,CACA,EAEA,SAAA,CACA,mBAAA,CACA,MAAA,CACA,CAAA,MAAA,KAAA,KAAA,OAAA,EACA,GAAA,KAAA,aAAA,KAAA,YAAA,CAAA,CAAAK,EAAAC,CAAA,KAAA,CAAA,MAAAD,EAAA,KAAAC,EAAA,YAAA,EAAA,CACA,CACA,EAEA,kBAAA,CACA,MAAA,CAAA,CAAA,MAAA,KAAA,KAAA,KAAA,EAAA,GAAA,KAAA,aAAA,KAAA,WAAA,UAAA,CAAA,CACA,EAEA,cAAA,CACA,MAAA,CAAA,CAAA,MAAA,KAAA,KAAA,OAAA,EAAA,GAAA,KAAA,aAAA,KAAA,WAAA,MAAA,CAAA,CACA,CACA,EAEA,MAAA,CACA,MAAA,CACA,QAAA,SAAAC,EAAA,CACA,KAAA,YAAA,CAAA,CACA,EACA,KAAA,EACA,EACA,KAAA,SAAAR,EAAA,CACA,eAAA,uBAAA,EAAAA,CACA,CACA,CACA"}